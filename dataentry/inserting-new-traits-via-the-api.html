<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Inserting New Traits Via the API | Biofuel Ecophysiological Traits and Yields Database</title>
  <meta name="description" content="6 Inserting New Traits Via the API | Biofuel Ecophysiological Traits and Yields Database" />
  <meta name="generator" content="bookdown 0.12.1 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Inserting New Traits Via the API | Biofuel Ecophysiological Traits and Yields Database" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Inserting New Traits Via the API | Biofuel Ecophysiological Traits and Yields Database" />
  
  
  

<meta name="author" content="By: BETYdb Team" />


<meta name="date" content="2019-07-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="adding-trait-and-yield-data.html">
<link rel="next" href="quality-assurance.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Volume 2 : Data Entry</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#authors"><i class="fa fa-check"></i><b>1.1</b> Authors</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#getting-started-1"><i class="fa fa-check"></i><b>2.2</b> Getting Started</a><ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started.html"><a href="getting-started.html#sign-up-for-betydb"><i class="fa fa-check"></i><b>2.2.1</b> Sign up for BETYdb</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started.html"><a href="getting-started.html#other-accounts"><i class="fa fa-check"></i><b>2.2.2</b> Other Accounts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="finding-and-preparing-published-data.html"><a href="finding-and-preparing-published-data.html"><i class="fa fa-check"></i><b>3</b> Finding and Preparing Published Data</a><ul>
<li class="chapter" data-level="3.1" data-path="finding-and-preparing-published-data.html"><a href="finding-and-preparing-published-data.html#meta-analyses"><i class="fa fa-check"></i><b>3.1</b> Meta-analyses</a></li>
<li class="chapter" data-level="3.2" data-path="finding-and-preparing-published-data.html"><a href="finding-and-preparing-published-data.html#preparing-publications-for-data-entry"><i class="fa fa-check"></i><b>3.2</b> Preparing Publications for Data Entry </a><ul>
<li class="chapter" data-level="3.2.1" data-path="finding-and-preparing-published-data.html"><a href="finding-and-preparing-published-data.html#mendeley"><i class="fa fa-check"></i><b>3.2.1</b> Mendeley</a></li>
<li class="chapter" data-level="3.2.2" data-path="finding-and-preparing-published-data.html"><a href="finding-and-preparing-published-data.html#recording-extracted-data-and-transformations"><i class="fa fa-check"></i><b>3.2.2</b> Recording extracted data and transformations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="entering-meta-data.html"><a href="entering-meta-data.html"><i class="fa fa-check"></i><b>4</b> Entering Meta-Data</a><ul>
<li class="chapter" data-level="4.1" data-path="entering-meta-data.html"><a href="entering-meta-data.html#adding-a-citation"><i class="fa fa-check"></i><b>4.1</b> Adding a Citation</a></li>
<li class="chapter" data-level="4.2" data-path="entering-meta-data.html"><a href="entering-meta-data.html#adding-a-site"><i class="fa fa-check"></i><b>4.2</b> Adding a Site</a><ul>
<li class="chapter" data-level="4.2.1" data-path="entering-meta-data.html"><a href="entering-meta-data.html#when-not-to-enter-a-new-site"><i class="fa fa-check"></i><b>4.2.1</b> When not to enter a new site</a></li>
<li class="chapter" data-level="4.2.2" data-path="entering-meta-data.html"><a href="entering-meta-data.html#site-location"><i class="fa fa-check"></i><b>4.2.2</b> Site Location</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="entering-meta-data.html"><a href="entering-meta-data.html#adding-treatments-and-managements"><i class="fa fa-check"></i><b>4.3</b> Adding Treatments and Managements</a><ul>
<li class="chapter" data-level="4.3.1" data-path="entering-meta-data.html"><a href="entering-meta-data.html#adding-a-treatment"><i class="fa fa-check"></i><b>4.3.1</b> Adding a Treatment</a></li>
<li class="chapter" data-level="4.3.2" data-path="entering-meta-data.html"><a href="entering-meta-data.html#adding-managements"><i class="fa fa-check"></i><b>4.3.2</b> Adding Managements</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="entering-meta-data.html"><a href="entering-meta-data.html#adding-a-pft-species-or-cultivar"><i class="fa fa-check"></i><b>4.4</b> Adding a PFT, Species, or Cultivar</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="adding-trait-and-yield-data.html"><a href="adding-trait-and-yield-data.html"><i class="fa fa-check"></i><b>5</b> Adding Trait and Yield Data</a><ul>
<li class="chapter" data-level="5.1" data-path="adding-trait-and-yield-data.html"><a href="adding-trait-and-yield-data.html#the-new-trait-and-new-yield-pages"><i class="fa fa-check"></i><b>5.1</b> The New Trait and New Yield Pages</a><ul>
<li class="chapter" data-level="5.1.1" data-path="adding-trait-and-yield-data.html"><a href="adding-trait-and-yield-data.html#adding-a-trait"><i class="fa fa-check"></i><b>5.1.1</b> Adding a Trait</a></li>
<li class="chapter" data-level="5.1.2" data-path="adding-trait-and-yield-data.html"><a href="adding-trait-and-yield-data.html#adding-a-yield"><i class="fa fa-check"></i><b>5.1.2</b> Adding a Yield</a></li>
<li class="chapter" data-level="5.1.3" data-path="adding-trait-and-yield-data.html"><a href="adding-trait-and-yield-data.html#adding-a-covariate"><i class="fa fa-check"></i><b>5.1.3</b> Adding a Covariate</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="adding-trait-and-yield-data.html"><a href="adding-trait-and-yield-data.html#bulk-upload"><i class="fa fa-check"></i><b>5.2</b> Bulk Upload</a><ul>
<li class="chapter" data-level="5.2.1" data-path="adding-trait-and-yield-data.html"><a href="adding-trait-and-yield-data.html#overview-1"><i class="fa fa-check"></i><b>5.2.1</b> Overview</a></li>
<li class="chapter" data-level="5.2.2" data-path="adding-trait-and-yield-data.html"><a href="adding-trait-and-yield-data.html#detailed-csv-data-file-specifications"><i class="fa fa-check"></i><b>5.2.2</b> Detailed CSV Data File Specifications</a></li>
<li class="chapter" data-level="5.2.3" data-path="adding-trait-and-yield-data.html"><a href="adding-trait-and-yield-data.html#using-the-bulk-upload-wizard"><i class="fa fa-check"></i><b>5.2.3</b> Using the Bulk Upload Wizard</a></li>
<li class="chapter" data-level="5.2.4" data-path="adding-trait-and-yield-data.html"><a href="adding-trait-and-yield-data.html#troubleshooting"><i class="fa fa-check"></i><b>5.2.4</b> Troubleshooting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html"><i class="fa fa-check"></i><b>6</b> Inserting New Traits Via the API</a><ul>
<li class="chapter" data-level="6.1" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#trait-insertion-endpoint."><i class="fa fa-check"></i><b>6.1</b> Trait Insertion Endpoint.</a></li>
<li class="chapter" data-level="6.2" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#format-of-data-files"><i class="fa fa-check"></i><b>6.2</b> Format of Data Files</a><ul>
<li class="chapter" data-level="6.2.1" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#schema-for-xml-data-files"><i class="fa fa-check"></i><b>6.2.1</b> Schema for XML Data Files</a></li>
<li class="chapter" data-level="6.2.2" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#schema-for-json-data-files"><i class="fa fa-check"></i><b>6.2.2</b> Schema for JSON Data Files</a></li>
<li class="chapter" data-level="6.2.3" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#schema-for-csv-data-files"><i class="fa fa-check"></i><b>6.2.3</b> Schema for CSV Data Files</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#error-feedback"><i class="fa fa-check"></i><b>6.3</b> Error Feedback</a><ul>
<li class="chapter" data-level="6.3.1" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#authorization-errors"><i class="fa fa-check"></i><b>6.3.1</b> Authorization Errors</a></li>
<li class="chapter" data-level="6.3.2" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#lookup-errors"><i class="fa fa-check"></i><b>6.3.2</b> Lookup Errors</a></li>
<li class="chapter" data-level="6.3.3" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#schema-validation-errors"><i class="fa fa-check"></i><b>6.3.3</b> Schema Validation Errors</a></li>
<li class="chapter" data-level="6.3.4" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#model-validation-errors"><i class="fa fa-check"></i><b>6.3.4</b> Model Validation Errors</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#running-the-examples"><i class="fa fa-check"></i><b>6.4</b> Running the Examples</a><ul>
<li class="chapter" data-level="6.4.1" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#using-curl-to-upload-the-data-samples"><i class="fa fa-check"></i><b>6.4.1</b> Using curl to Upload the Data Samples</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="inserting-new-traits-via-the-api.html"><a href="inserting-new-traits-via-the-api.html#known-bugs"><i class="fa fa-check"></i><b>6.5</b> Known Bugs</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="quality-assurance.html"><a href="quality-assurance.html"><i class="fa fa-check"></i><b>A</b> Quality Assurance</a></li>
<li class="chapter" data-level="B" data-path="extracting-information-from-figures.html"><a href="extracting-information-from-figures.html"><i class="fa fa-check"></i><b>B</b> Extracting information from figures </a><ul>
<li class="chapter" data-level="" data-path="extracting-information-from-figures.html"><a href="extracting-information-from-figures.html#for-more-information"><i class="fa fa-check"></i>For more information:</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="estimating-standard-error-from-other-summary-statistics-p-lsd-msd.html"><a href="estimating-standard-error-from-other-summary-statistics-p-lsd-msd.html"><i class="fa fa-check"></i><b>C</b> Estimating Standard Error from other summary statistics (<em>P</em>, <em>LSD</em>, <em>MSD</em>)</a><ul>
<li class="chapter" data-level="" data-path="estimating-standard-error-from-other-summary-statistics-p-lsd-msd.html"><a href="estimating-standard-error-from-other-summary-statistics-p-lsd-msd.html#further-reading"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="common-unit-conversions.html"><a href="common-unit-conversions.html"><i class="fa fa-check"></i><b>D</b> Common Unit Conversions</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a><ul>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html#developers"><i class="fa fa-check"></i>Developers</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html#funding-sources"><i class="fa fa-check"></i>Funding Sources</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Biofuel Ecophysiological Traits and Yields Database</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="inserting-new-traits-via-the-api" class="section level1">
<h1><span class="header-section-number">6</span> Inserting New Traits Via the API</h1>
<p>This page provides a general description of how to insert trait data via the v1 version of the BETYdb API. For information about <em>accessing</em> data via the v1 BETYdb API, visit <a href="https://pecan.gitbooks.io/betydb-data-access/content/API/beta_API.html" class="uri" target="_blank">https://pecan.gitbooks.io/betydb-data-access/content/API/beta_API.html</a>. For a list of URLs of API endpoints, visit <a href="https://www.betydb.org/api/docs" class="uri" target="_blank">https://www.betydb.org/api/docs</a>.</p>
<div id="trait-insertion-endpoint." class="section level2">
<h2><span class="header-section-number">6.1</span> Trait Insertion Endpoint.</h2>
<p>The path to use for trait insertion is <code>/api/v1/traits(.EXT)</code> where <code>EXT</code> is <code>csv</code>, <code>xml</code>, or <code>json</code>. These are used to submit data in CSV, XML, and JSON format, respectively. If no extension is given, JSON format is assumed. <strong>A user must have <em>Creator</em> status (page access level 3) in order to use the trait insertion API.</strong></p>
</div>
<div id="format-of-data-files" class="section level2">
<h2><span class="header-section-number">6.2</span> Format of Data Files</h2>
<p>To see some valid sample files in all three of the supported formats, see <a href="inserting-new-traits-via-the-api.html#running-the-examples">Running the Examples</a> below.</p>
<div id="schema-for-xml-data-files" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Schema for XML Data Files</h3>
<p>XML data files must validate against the schema specified by <code>app/lib/api/validation/TraitData.xsd</code>. It is possible to validate files on the command line with <code>xmllint</code>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">xmllint</span> --schema path/to/TraitData.xsd --noout path/to/xml-data-file</code></pre></div>
<p>Note that data files of other types (CSV and JSON) are converted to XML internally and then validated using this schema.</p>
<div id="general-outline-and-semantics-of-xml-data-files" class="section level4">
<h4><span class="header-section-number">6.2.1.1</span> General Outline and Semantics of XML Data Files</h4>
<ul>
<li><p>The root level elements is named <code>trait-data-set</code>.</p></li>
<li><p><code>trait</code> elements appear below the root, either directly, or nested within intervening <code>trait-group</code> elements.</p></li>
<li><p>A <code>trait</code> element must include a <code>mean</code> attribute with a value of type double. An exponent may be used; for example, in place of “0.0123” one may write “1.23E-2”.</p></li>
<li><p>A <code>trait</code> element <em>may</em> have the following attributes:</p>
<ul>
<li><p>An attribute <code>utc_datetime</code> whose value has the form “YYYY-MM-DDZ” or “YYYY-MM-DDTHH:MM:SSZ” which represents the date or date and time the trait measurement was taken. The trailing “Z” emphasizes that the value is in UTC time and is required. If a time of day is given, the symbol “T” must separate the time from the date. If a time is given, fractional seconds may be included.</p></li>
<li><p>A <code>local_datetime</code> attribute may be used in place of <code>utc_datetime</code>. This represents the date or date and time of a trait measurement in local time. This attribute may only be used if the trait is associated with a site having a specified time zone. The value format is the same as for <code>utc_datetime</code> except there is no trailing “Z”.</p></li>
<li><p>An attribute <code>access_level</code> <em>must</em> be supplied unless it is supplied using the defaulting mechanism (see below).</p></li>
</ul></li>
<li><p>A <code>trait</code> element <em>may</em> have the following child elements:</p>
<ul>
<li><p><code>site</code>: This <em>may</em> have any of the attributes <code>id</code>, <code>city</code>, <code>state</code>, <code>country</code>, and <code>sitename</code>. It <em>must</em> have enough of these attributes to uniquely identify an existing site. Withing the database table <code>sites</code>, the values of <code>sitename</code> <em>should</em> be unique and <code>sitename</code> is the preferred attribute to use in identifying a site. Unfortunately, uniqueness is not currently enforced and there are in fact several cases of multiple sites sharing the same site name. <strong><em>In general, using the <code>id</code> attribute to identify a particular trait association is strongly discouraged and should be used only when necessary.</em></strong></p></li>
<li><p><code>species</code>: Allowed attributes: <code>id</code>, <code>genus</code>, <code>species</code>, <code>scientificname</code>, <code>commonname</code>, <code>AcceptedSymbol</code>. <code>scientificname</code> is the preferred attribute for identifying a species. Within the database table <code>species</code>, non-blank values of <code>scientificname</code> should be unique but this constraint is not yet enforced. (<code>scientificname</code> is left blank in cases where a species row represents a category of plant; in this case, the <code>commonname</code> column is used to describe the category.)</p>
<p>If a particular cultivar of the species is intended, a child <code>cultivar</code> element should be included. This element may use either a <code>name</code> attribute (preferred) or an <code>id</code> attribute to identify the cultivar. <em>Cultivar names are guaranteed to be unique within a given species.</em></p></li>
<li><p><code>citation</code>: Allowed attributes: <code>id</code>, <code>author</code>, <code>year</code>, <code>title</code>, <code>doi</code>. The preferred method of selecting a citation is by doi or by author, year, and title (often just author and year will suffice).</p></li>
<li><p><code>treatment</code>: Allowed attributes: <code>id</code>, <code>name</code>, <code>control</code>. The preferred method of selecting a method is by name. [In the process of implementation: A citation is <em>required</em>, either directly on the trait or as a default for a group of traits, if a treatment is to be specified. Moreover, the specified treatment must be associated with the specified citation. This will often make it possible to use the <code>name</code> attribute to specify a treatment, since only treatments associated with the given citation will be considered when selecting by name.]</p></li>
<li><p><code>variable</code>: This specifies what the trait measure. This element must be included if it is not specified in a <code>defaults</code> element (see below). Allowed attributes: <code>id</code>, <code>name</code>, <code>description</code>. <code>name</code> is the preferred attribute to use to specify the variable and <em>should</em> be unique, but this isn’t yet enforced and there are a few cases of duplicates.</p></li>
<li><p><code>method</code>: Allowed attributes: <code>name</code>. This element <em>must</em> have a citation child element. (This citation has no ostensive relation to the citation associated with the trait.) Together, the name and the citation should uniquely determine which method is being used. [To do: Constrain the <code>methods</code> table to ensure that this is always possible.]</p></li>
<li><p><code>covariates</code>: This element specifies what covariates are associated with a trait measurement. It allows no attributes but must contain one or more <code>covariate</code> child elements. Each <code>covariate</code> element must contain a <code>variable</code> element (specifying what the covariate measures) and have a <code>level</code> attribute (specifying the value of that measurement).</p></li>
<li><p><code>entity</code>: Allowed attributes: <code>name</code> and <code>notes</code>. An entity with the given value for <code>name</code> and <code>notes</code> will be created if no entity with the given name exists. [To be implemented: It is an error to specify an entity at the trait level having a blank name. It is an error to supply a <code>notes</code> attribute if <code>name</code> refers to an existing entity.] [To do: Guarantee uniqueness of non-blank names in the entities table.]</p></li>
</ul>
<p>The eight elements just mentioned specify how the trait is associated with data in other tables. In addition, a trait may include two additional elements that further describe the trait:</p>
<ul>
<li><p><code>stat</code>: If a trait describes a group of of measurements (as opposed to a single measurement), a <code>stat</code> element may be included. It <em>must</em> have the following three attributes:</p>
<ul>
<li><p><code>sample_size</code>, a positive integer.</p></li>
<li><p><code>name</code>, the name of the statistic measured. Possible values are “SD”, “SE”, “MSE” “95%Cl”, “LSD”, and “MSD”.</p></li>
<li><p><code>value</code>, a double giving the value of the named statistic.</p></li>
</ul></li>
<li><p><code>notes</code>: This is an element having no attributes but containing free-form textual content.</p></li>
</ul></li>
<li><p>Using a single entity for the whole data set.</p>
<p>If all of the traits in the data set should share the same entity, it is possible to specify this by placing an <code>entity</code> element as the first child of the root <code>trait-data-set</code> element. The element has the same form as an <code>entity</code> element contained inside a <code>trait</code> element except that this <em>global</em> entity is allowed to be anonymous, that is, to have no name or notes attribute. If a global <code>entity</code> element is used, it must be the only <code>entity</code> element in the document, and no <code>trait-group</code> elements may be used in the document (see below).</p></li>
<li><p>Trait groups.</p>
<p>If a group of traits share a number of characteristics, it is possible to nest them within a <code>trait-group</code> element. This is mainly useful in the following two cases:</p>
<ul>
<li><p>Some (but not all) of the traits in the file should be associated with the same entity.</p></li>
<li><p>Some (but not all) of the traits in the file share the same metadata (site, citation, treatment, variable, date, species, etcetera).</p></li>
</ul>
<p>Multiple level of nesting may be used: <code>trait-group</code> elements may themselves contain <code>trait-group</code> elements.</p></li>
<li><p>Entities for trait groups.</p>
<p>If a <code>trait-group</code> element has no <code>trait-group</code> child element, then it may contain, as its first child element, an <code>entity</code> element. This usage is similar to the data-set entity usage describe above except that the entity will only be used for the traits in the trait group. If a trait group <em>does</em> use an <code>entity</code> element, then none of the traits in the trait group can have their own <code>entity</code> element.</p></li>
<li><p>Specifying metadata for sets of traits.</p>
<p>If many traits have a common citation, site, species, etcetera, it is possible to avoid repeating this information for each individual trait by using a <code>defaults</code> element. A <code>defaults</code> element may appear as the child of the <code>trait-data-set</code> element (in which case the defaults apply to all of the traits in the document) or as the child of a <code>trait-group</code> element (in which case it applies only to the traits within that group).</p>
<p><code>defaults</code> elements have many of the same attributes and child elements as <code>trait</code> elements:</p>
<ul>
<li><p>Allowed attributes are <code>access_level</code>, <code>utc_datetime</code>, and <code>local_datetime</code>. <code>local_datetime</code> is allowed only if a site having a time zone is specified in the <code>defaults</code> element or in a <code>defaults</code> element at a higher level and if the specified site is not overridden at a lower level (see below).</p></li>
<li><p>Allowed child elements are <code>site</code>, <code>species</code>, <code>citation</code>, <code>treatment</code>, <code>variable</code>, and <code>method</code>.</p></li>
<li><p>As for the other attributes and elements used with <code>trait</code> elements, since the <code>mean</code> attribute and the <code>stat</code>, <code>notes</code>, and <code>covariates</code> elements are inherently trait-specific, they cannot be used with the <code>defaults</code> element. (<code>entity</code> elements applying to groups of traits are direct children of the <code>trait-data-set</code> element or a <code>trait-group</code> element rather than being nested within a <code>defaults</code> element.)</p></li>
</ul>
<p>A default specified by a <code>defaults</code> element will apply to all traits occuring within the parent of the <code>defaults</code> element unless overridden. A default may be overridden either by another <code>defaults</code> element appearing at a lower level or by attributes and child elements of an individual trait.</p></li>
</ul>
</div>
</div>
<div id="schema-for-json-data-files" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Schema for JSON Data Files</h3>
<p>[To-do]</p>
</div>
<div id="schema-for-csv-data-files" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Schema for CSV Data Files</h3>
<p>The format to use for CSV trait data files is largely the same as that required for the Bulk Upload wizard explained in the <a href="bulk%20upload.md">previous section</a>. (See the templates traits.csv and traits_by_doi.csv.) Some significant differences from the bulk-upload case are:</p>
<ol style="list-style-type: decimal">
<li><p>The date of a trait measurement must be given in a column with one of the following headings.</p>
<ol style="list-style-type: lower-alpha">
<li><p>If the heading “utc_datetime” is used, the supplied values must conform to one of the following formats: <code>1918-11-11T10:00:00Z</code> or <code>1918-11-11Z</code>. In particular, the time must be given in UTC time (hence the “Z”), and if the time is specified (first format), the letter “T” must separate the date and the time portions. If the time is specified, seconds must be included; optionally, fractional seconds may be included as well. The resulting <code>dateloc</code> value will always be <code>5</code> (exact date); the <code>timeloc</code> value will be <code>1</code> (time to the second) if a time is given and <code>9</code> (no data) otherwise.</p></li>
<li><p>If the heading “local_datetime” is used, the supplied values must conform to one of the following formats: <code>1918-11-11T11:00:00</code> or <code>1918-11-11</code>. In particular, if the time is specified (first format), the letter “T” must separate the date and the time portions. If the time is specified, seconds must be included; optionally, fractional seconds may be included as well. The resulting <code>dateloc</code> value will always be <code>5</code> (exact date); the <code>timeloc</code> value will be <code>1</code> (time to the second) if a time is given and <code>9</code> (no data) otherwise.</p>
<p>When “local_datetime” is used to specify the date-time value of a trait measurement, the date and time are assumed to be local (site) time if a site is given and if that site has a time zone value stored. Otherwise, the value given is assumed to be UTC time. (The date-time value is always stored in the database as UTC time. This paragraph has to do with how the supplied date-time value is interpreted when read.)</p></li>
</ol>
<p>Note that only one or the other of these columns may occur in the CSV file. Otherwise an error results.</p></li>
<li><p>Meta-data can not be specified interactively. Thus any associated citation, site, species, cultivar, or treatment must be specified in each row of the CSV file. (This may later change so that repeated metadata specification may be avoided.)</p></li>
<li><p>Unlike the bulk upload case, matching of metadata entries <em>is</em> case sensitive. Thus, if the CSV file specifies the species as “Sorghum Bicolor” but the database entry for the species specifies the scientificname as “Sorghum bicolor”, the upload will not be successful.</p></li>
<li><p>Unlike the bulk upload case, it is not necessary to specify an associated citation, site, species, or treatment. The sample file <code>SIMPLE_CSV_TEST_DATA</code> demonstrates the case where a trait value having no associated metadata is inserted.</p></li>
<li><p>It <em>is</em> required, however, to specify an access level for each trait; therefore, the CSV file <em>must</em> have a column named <code>access_level</code>.</p></li>
<li><p>When specifying the citation in a CSV file for use with the Bulk Upload wizard, it is necessary to have either a <code>citation_doi</code> column, or have all three of the columns <code>citation_author</code>, <code>citation_year</code>, and <code>citation_title</code>. When using the API, however, any combination of these may be used so long as the values specified in each row determine a unique citation. For example, if there is only one citation with author “Doe”, and if that is the value that occurs in the <code>citation_author</code> column of every row of the table, then it is unnecessary to have a <code>citation_year</code> or <code>citation_title</code> column.</p></li>
<li><p>Just as for bulk uploads, the <code>trait_covariate_associations</code> table is consulted to determine which column names correspond to trait variables and which ones correspond to covariate variables, and further, which covariates correspond to which traits. <strong>But failing to specify a required covariate for one or more traits will not result in an error.</strong> (Thus, in essence, <em>required</em> covariates are treated just like <em>optional</em> covariates; they will be associated if present, but no complaint will be made if they are not.)</p></li>
<li><p>No rounding is done of floating point values except to the extent required to fit within PostgreSQL’s 8-byte float type. (Note that all floating point values <em>may</em> be specifed with an exponent; for example 3.20E-2 in place of 0.0320.)</p></li>
</ol>
</div>
</div>
<div id="error-feedback" class="section level2">
<h2><span class="header-section-number">6.3</span> Error Feedback</h2>
<p>As mentioned above, all trait insertion API calls generate an HTTP response. The response will use the same format as the format of the file submitted except in the case of CSV files, where the response is given in JSON format.</p>
<p>In the case of unsuccessful API calls, the response will contain information about the types of errors that caused the call to be unsuccessful. These errors can be classified as follows:</p>
<div id="authorization-errors" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Authorization Errors</h3>
<p>If an invalid API key is given, or if the given key is for a user who isn’t authorized to perform the given action, an authorization error is returned. (To do: Distinguish between authentication and authorization.)</p>
</div>
<div id="lookup-errors" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Lookup Errors</h3>
<p>If a citation, site, species, or treatment is specified that doesn’t match exactly one item in the database, a lookup error occurs. This causes the whole data set to be returned in tree form as <code>annotated_post_data</code>. The annotations will be the error items next to the data item that caused the error.</p>
</div>
<div id="schema-validation-errors" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Schema Validation Errors</h3>
<p>As mentioned above, data files in CSV and JSON format are converted to XML format and then validated against an XML schema. For CSV files, since the structure of the XML document generated by the converter is generally correct, this error usually arises only when a data value of the wrong type is given (for example, an alphabetical string where a number is expected). But there are other situations that can trigger a validation error: for example, if a sample size column (<code>n</code>) is given without including a standard error (<code>SE</code>) column, or vice versa.<a href="#fn12" class="footnoteRef" id="fnref12"><sup>12</sup></a></p>
</div>
<div id="model-validation-errors" class="section level3">
<h3><span class="header-section-number">6.3.4</span> Model Validation Errors</h3>
<p>These errors occur when attempting to save a Trait object to the database and may occur if a variable value is found to be out of range or if a required attribute (e.g. <code>access_level</code>) is missing. As in the lookup error case, this causes the whole data set to be returned in tree form as <code>annotated_post_data</code>.</p>
</div>
</div>
<div id="running-the-examples" class="section level2">
<h2><span class="header-section-number">6.4</span> Running the Examples</h2>
<p>There are five sample data files in the directory <code>app/lib/api/test</code>.</p>
<p><code>SIMPLE_XML_TEST_DATA</code>: A minimal XML data file consisting of a single trait. It provides only the (currently) required values: the trait variable name, the trait value, and an access level to specify who may view this data item.</p>
<p><code>SIMPLE_CSV_TEST_DATA</code>: A minimal CSV data file consisting of a single trait. It provides only a single variable name and value and the access level.</p>
<p><code>TEST_XML_DATA</code>: A full-fledged XML data file making use of all of the features available for XML trait data insertion: specification of defaults for groups of traits, meta-data lookup, and complete latitude for associating specific groups of covariates and specific sample statistics with specific traits.</p>
<p><code>TEST_JSON_DATA</code>: This JSON data file is an exact analogue to <code>TEST_XML_DATA</code>; it should result in exactly the same trait data being inserted.</p>
<p><code>TEST_CSV_DATA</code>: This CSV data file has five column headings corresponding trait variables and two columns headings corresponding to covariate variable. There is a single data row, so when this file is ingested, a single new entity will be created having 5 associated traits and each trait will have 2 associated covariates. Complete metadata is given for the entity (or equivalently, for the traits it comprises).</p>
<div id="using-curl-to-upload-the-data-samples" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Using curl to Upload the Data Samples</h3>
<p>You can upload the data in these files using <code>curl</code>. To try this out, start your Rails server locally with <code>rails s</code> and then, from the <code>/api/lib/api/test</code> directory, run the command</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">curl</span> -X POST --data-binary @TEST_XML_DATA localhost:3000/api/v1/traits.xml?key=<span class="op">&lt;</span>your API key<span class="op">&gt;</span></code></pre></div>
<p>(Substitute any of the other sample file names for <code>TEST_XML_DATA</code> as desired, changing the <code>.xml</code> extension to <code>.json</code> or <code>.csv</code> where appropriate. <strong><em>If a CSV file is being uploaded, add the option <code>-H &quot;Content-Type: text/csv&quot;</code> to the <code>curl</code> command.</em></strong>)</p>
<p>These API calls all generate a response (in XML format for the XML endpoint and in JSON format for the JSON endpoints). If the call is successful, the response will contain a list of the ids of the new traits that were inserted. Note that new entities and possibly new covariates will also be inserted, but the information about these is not (currently) contained in the response.</p>
</div>
</div>
<div id="known-bugs" class="section level2">
<h2><span class="header-section-number">6.5</span> Known Bugs</h2>
<ol style="list-style-type: decimal">
<li><p>It’s too easy to make a mistake without realizing it.</p>
<p>Examples:</p>
<ol style="list-style-type: lower-alpha">
<li><p>If you misspell a trait variable name in the heading, that column will simple be ignored; no error will occur if there exists at least one valid trait variable in the heading.</p></li>
<li><p>If you include the same heading twice, the value is one column will overwrite those in the other.</p></li>
</ol></li>
<li><p>Some error messages are obscure and seemingly unrelated to the error that triggered them.</p></li>
</ol>

</div>
</div>



</div>
<div class="footnotes">
<hr />
<ol start="12">
<li id="fn12"><p>These errors should really be detected during CSV file parsing before attempting to convert to a valid XML file.<a href="inserting-new-traits-via-the-api.html#fnref12">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="adding-trait-and-yield-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="quality-assurance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
